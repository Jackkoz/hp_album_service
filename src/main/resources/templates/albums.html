<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Albums</title>

    <!-- Bootstrap CSS -->
    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
    >
</head>
<body>

<div class="container py-4">

    <form
            th:action="@{/albums}"
            method="get"
            class="w-50"
    >
        <div class="input-group">
            <input
                    type="text"
                    class="form-control"
                    name="artist"
                    placeholder="Find different artist"
                    aria-label="Artist name"
                    required
            >
            <button class="btn btn-primary" type="submit">
                Search
            </button>
        </div>
    </form>

    <span id="span-large"> <br /></span>

    <!-- Search box -->
    <div class="mb-4">
        <input
                type="text"
                id="albumSearch"
                class="form-control w-50"
                placeholder="Filter albums..."
                onkeyup="filterAlbums()"
        >
    </div>

    <!-- No results message (server-side when list is empty) -->
    <div
            id="noResults"
            class="text-muted"
            th:if="${#lists.isEmpty(albums)}"
    >
        No results found
    </div>

    <!-- Album grid -->
    <div
            class="row g-4"
            id="albumGrid"
            th:if="${!#lists.isEmpty(albums)}"
    >
        <div
                class="col-6 col-sm-4 col-md-3 col-lg-2 album-card"
                th:each="album : ${albums}"
                th:data-name="${album.name}"
        >
            <div class="card h-100 text-center">
                <img
                        th:src="${album.thumbnailUrl}"
                        class="card-img-top"
                        alt="Album thumbnail"
                >
                <div class="card-body p-2">
                    <p
                            class="card-text small fw-semibold"
                            th:text="${album.name}">
                    </p>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- Bootstrap JS (optional) -->
<script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js">
</script>

<!-- Client-side filtering -->
<script>
    function filterAlbums() {
        const searchValue = document.getElementById("albumSearch").value.toLowerCase();
        const albums = document.getElementsByClassName("album-card");
        const noResults = document.getElementById("noResults");

        let visibleCount = 0;

        for (let album of albums) {
            const albumName = album.getAttribute("data-name").toLowerCase();
            const isVisible = searchValue === "" ? true : albumName.includes(searchValue);
            album.style.display = isVisible ? "" : "none";
            if (isVisible) visibleCount++;
        }

        // Show/hide "No results found" during filtering
        if (noResults) {
            noResults.style.display = visibleCount === 0 ? "block" : "none";
        }
    }
</script>

</body>
</html>
